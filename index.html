<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Planner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-image: linear-gradient(to bottom right, black, #222222);
      color: #eeeeee;
      min-height: 100vh;
      padding-bottom: 25vh;
    }
    *:focus {
      outline: none;
      filter: brightness(1.15);
      transition: all .15s ease;
    }

    .event-box {
      border: 1px solid #28a745;
      padding: 15px;
      margin-bottom: 10px;
      position: relative;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      animation: animate 0.15s ease-in-out;
    }

    @keyframes animate {
      from {
        transform: scale(0.95);
        opacity: 0;
      }

      to {
        transform: scale(1);
      }
    }

    .event-box input,
    .event-box textarea {
      display: block;
      margin: 5px 0;
      width: 100%;
      padding: 6px;
      box-sizing: border-box;
    }

    .add-btn {
      position: absolute;
      top: -10px;
      right: -10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      border: none;
      background: #28a745;
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
    }

    #generate-btn {
      position: fixed;
      bottom: 25px;
      width: calc(100vw - 80px);
      margin-left: 10px;
      padding-inline: none;
      padding-block: 6px;
      font-size: 16px;
      border-radius: 20px;
      border: 1px solid #28a745;
      color: #dddddd;
      background-color: #28a745;
      z-index: 1;
    }

    input,
    textarea {
      border-radius: 5px;
      border: none;
      background-color: #555555;
      color: #dddddd;
    }

    ::placeholder {
      color: #dddddd;
    }

    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      backdrop-filter: blur(2px) saturate(150%);
      height: calc(2 * 6px + 16px + 8px + 10px + 35px);
    }
    @media (min-width: 400px) {
      .event-box {
        width: 300px;
        display: inline-block;
        margin-inline: 12px;
      }
      #generate-btn {
        width: auto;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 25px;
      }
      body {
        padding-bottom: 64px;
      }
    }
  </style>
</head>

<body>

  <h1>Event Planner</h1>

  <div id="events-container"></div>

  <button id="generate-btn">Get your event file</button>
  <nav></nav>
  <script>
    console.log(' All fields are to be filled. Leaving an input empty will result in a damaged file.');
    console.log(' Click "+" to add another event. You will download a single file containing everything.');
    console.log(' After clicking the download button, the file will be saved. Once opened, just click "Add to calendar".');
    console.log(" That's it!")
    // Function to create a new event box
    function createEventBox(prefillData = {}) {
      const container = document.getElementById('events-container');

      const box = document.createElement('div');
      box.className = 'event-box';

      const title = document.createElement('input');
      title.type = 'text';
      title.placeholder = 'Event Title';
      title.value = prefillData.title || '';

      const description = document.createElement('textarea');
      description.placeholder = 'Event Description';
      description.value = prefillData.description || '';

      const start = document.createElement('input');
      start.type = 'datetime-local';
      start.value = prefillData.start || '';

      const end = document.createElement('input');
      end.type = 'datetime-local';
      end.value = prefillData.end || '';

      const addBtn = document.createElement('button');
      addBtn.className = 'add-btn';
      addBtn.textContent = '+';
      addBtn.onclick = () => {
        const lastBoxData = {
          title: title.value,
          description: description.value,
          start: start.value,
          end: end.value
        };
        createEventBox(lastBoxData);
      }

      box.appendChild(title);
      box.appendChild(description);
      box.appendChild(start);
      box.appendChild(end);
      box.appendChild(addBtn);

      container.appendChild(box);
    }

    // Function to generate ICS content
    function generateICS() {
      const boxes = document.querySelectorAll('.event-box');
      let icsContent = `BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
`;

      boxes.forEach((box, index) => {
        const title = box.querySelector('input[type="text"]').value;
        const description = box.querySelector('textarea').value;
        const start = box.querySelector('input[type="datetime-local"]').value;
        const end = box.querySelectorAll('input[type="datetime-local"]')[1].value;

        if (!start || !end) return;

        const formatDate = (dateStr) => {
          return dateStr.replace(/[-:]/g, '').replace('T', 'T') + '00Z';
        };

        icsContent += `BEGIN:VEVENT
UID:event-${index}@example.com
SUMMARY:${title}
DESCRIPTION:${description}
DTSTART:${formatDate(start)}
DTEND:${formatDate(end)}
END:VEVENT
`;
      });

      icsContent += 'END:VCALENDAR';

      const blob = new Blob([icsContent], { type: 'text/calendar' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'events.ics';
      link.click();
    }

    // Initialize with one event box
    createEventBox();

    // Attach generate button
    document.getElementById('generate-btn').onclick = generateICS;
  </script>

</body>

</html>