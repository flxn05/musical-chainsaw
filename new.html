<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event ICS Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  .event-box {
    border: 1px solid #ccc;
    padding: 15px;
    margin-bottom: 10px;
    position: relative;
    border-radius: 8px;
  }
  .event-box input, .event-box textarea {
    display: block;
    margin: 5px 0;
    width: 100%;
    padding: 6px;
    box-sizing: border-box;
  }
  .add-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    cursor: pointer;
    font-size: 20px;
    border: none;
    background: #28a745;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
  }
  #generate-btn {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
  }
</style>
</head>
<body>

<h1>Event ICS Generator</h1>

<div id="events-container"></div>

<button id="generate-btn">Generate</button>

<script>
  // Function to create a new event box
  function createEventBox(prefillData = {}) {
    const container = document.getElementById('events-container');

    const box = document.createElement('div');
    box.className = 'event-box';

    const title = document.createElement('input');
    title.type = 'text';
    title.placeholder = 'Event Title';
    title.value = prefillData.title || '';
    
    const description = document.createElement('textarea');
    description.placeholder = 'Event Description';
    description.value = prefillData.description || '';

    const start = document.createElement('input');
    start.type = 'datetime-local';
    start.value = prefillData.start || '';

    const end = document.createElement('input');
    end.type = 'datetime-local';
    end.value = prefillData.end || '';

    const addBtn = document.createElement('button');
    addBtn.className = 'add-btn';
    addBtn.textContent = '+';
    addBtn.onclick = () => {
      const lastBoxData = {
        title: title.value,
        description: description.value,
        start: start.value,
        end: end.value
      };
      createEventBox(lastBoxData);
    }

    box.appendChild(title);
    box.appendChild(description);
    box.appendChild(start);
    box.appendChild(end);
    box.appendChild(addBtn);

    container.appendChild(box);
  }

  // Function to generate ICS content
  function generateICS() {
    const boxes = document.querySelectorAll('.event-box');
    let icsContent = `BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
`;

    boxes.forEach((box, index) => {
      const title = box.querySelector('input[type="text"]').value;
      const description = box.querySelector('textarea').value;
      const start = box.querySelector('input[type="datetime-local"]').value;
      const end = box.querySelectorAll('input[type="datetime-local"]')[1].value;

      if (!start || !end) return;

      const formatDate = (dateStr) => {
        return dateStr.replace(/[-:]/g, '').replace('T', 'T') + '00Z';
      };

      icsContent += `BEGIN:VEVENT
UID:event-${index}@example.com
SUMMARY:${title}
DESCRIPTION:${description}
DTSTART:${formatDate(start)}
DTEND:${formatDate(end)}
END:VEVENT
`;
    });

    icsContent += 'END:VCALENDAR';

    const blob = new Blob([icsContent], { type: 'text/calendar' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'events.ics';
    link.click();
  }

  // Initialize with one event box
  createEventBox();

  // Attach generate button
  document.getElementById('generate-btn').onclick = generateICS;
</script>

</body>
</html>
